<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digibase API Showcase ðŸš€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <style>
        /* Custom scrollbar for log window */
        .logs::-webkit-scrollbar { width: 8px; }
        .logs::-webkit-scrollbar-track { background: #1f2937; }
        .logs::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans antialiased min-h-screen p-6">

    <header class="max-w-7xl mx-auto mb-10 flex justify-between items-center border-b border-gray-700 pb-6">
        <div>
            <h1 class="text-3xl font-bold text-blue-500">Digibase API Showcase âš¡</h1>
            <p class="text-gray-400 mt-2">Live interaction with your Backend-as-a-Service.</p>
        </div>
        <div class="text-right">
            <div class="text-sm text-gray-500">API Status</div>
            <div class="flex items-center gap-2">
                <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                <span class="font-mono text-green-400">ONLINE</span>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">

        <div class="space-y-8">

            <section class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-lg">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <span class="bg-blue-600 text-xs px-2 py-1 rounded">1</span> Configuration
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">API Base URL</label>
                        <input type="text" id="baseUrl" value="/api" class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-white focus:border-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Auth Token (Bearer)</label>
                        <div class="flex gap-2">
                            <input type="text" id="authToken" placeholder="Login to generate token..." readonly class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-green-400 font-mono text-sm focus:border-blue-500 outline-none">
                            <button onclick="clearToken()" class="bg-gray-700 hover:bg-gray-600 px-3 rounded text-sm">Clear</button>
                        </div>
                    </div>
                </div>
            </section>

            <section class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-lg">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <span class="bg-purple-600 text-xs px-2 py-1 rounded">2</span> Authentication
                </h2>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-3">
                        <input type="email" id="loginEmail" placeholder="admin@example.com" class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm">
                        <input type="password" id="loginPass" placeholder="password" class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm">
                        <button onclick="login()" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-medium py-2 rounded transition">Login</button>
                    </div>
                    <div class="space-y-3">
                        <button onclick="getUser()" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 rounded transition">Get Current User</button>
                        <button onclick="logout()" class="w-full bg-red-900/50 hover:bg-red-900 text-red-200 font-medium py-2 rounded transition">Logout</button>
                    </div>
                </div>
            </section>

            <section class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-lg">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <span class="bg-green-600 text-xs px-2 py-1 rounded">3</span> Dynamic Data Engine
                </h2>
                <div class="space-y-4">
                    <div class="flex gap-2">
                        <span class="bg-gray-700 px-3 py-2 rounded-l text-gray-400 font-mono text-sm border border-gray-600 border-r-0 pt-2.5">/data/</span>
                        <input type="text" id="collectionName" placeholder="posts (Table Name)" class="w-full bg-gray-900 border border-gray-600 rounded-r px-3 py-2 text-white focus:border-green-500 outline-none">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="fetchData()" class="bg-green-600 hover:bg-green-500 text-white py-2 rounded font-medium">GET (List)</button>
                        <button onclick="createData()" class="bg-blue-600 hover:bg-blue-500 text-white py-2 rounded font-medium">POST (Create)</button>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">JSON Payload (For Create/Update)</label>
                        <textarea id="jsonPayload" rows="3" class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 font-mono text-sm text-yellow-300 focus:border-blue-500 outline-none">
{
  "title": "New Item",
  "is_active": true
}</textarea>
                    </div>
                </div>
            </section>

            <section class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-lg">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <span class="bg-orange-600 text-xs px-2 py-1 rounded">4</span> Storage Engine
                </h2>
                <div class="space-y-3">
                    <input type="file" id="fileInput" class="w-full bg-gray-900 border border-gray-600 rounded text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-orange-600 file:text-white hover:file:bg-orange-500">
                    <div class="flex items-center gap-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="isPublic" checked class="rounded bg-gray-900 border-gray-600 text-orange-600 focus:ring-0">
                            <span class="text-sm text-gray-300">Is Public?</span>
                        </label>
                        <button onclick="uploadFile()" class="flex-1 bg-orange-600 hover:bg-orange-500 text-white font-medium py-2 rounded transition">Upload File</button>
                    </div>
                </div>
            </section>

        </div>

        <div class="flex flex-col h-full min-h-[600px]">
            <div class="bg-gray-900 border border-gray-700 rounded-t-xl p-4 flex justify-between items-center">
                <h3 class="font-mono text-sm text-gray-400">Live API Console</h3>
                <button onclick="clearLog()" class="text-xs text-gray-500 hover:text-white">Clear Console</button>
            </div>
            <div id="consoleOutput" class="logs bg-[#0d1117] border border-t-0 border-gray-700 rounded-b-xl flex-1 p-4 font-mono text-sm overflow-auto max-h-[800px]">
                <div class="text-gray-500 italic">Waiting for requests...</div>
            </div>
        </div>

    </main>

    <footer class="max-w-7xl mx-auto mt-12 text-center text-gray-500 text-sm pb-8">
        Powered by <span class="text-blue-500 font-bold">Digibase</span> &bull; The Vibe Coder's BaaS
    </footer>

    <script>
        const logArea = document.getElementById('consoleOutput');
        
        // --- Logger Function ---
        function log(type, method, url, status, data) {
            if (logArea.querySelector('.italic')) logArea.innerHTML = '';

            const color = status >= 200 && status < 300 ? 'text-green-400' : 'text-red-400';
            const timestamp = new Date().toLocaleTimeString();

            const entry = document.createElement('div');
            entry.className = "mb-6 border-b border-gray-800 pb-4 last:border-0";
            entry.innerHTML = `
                <div class="flex items-center gap-3 mb-2">
                    <span class="text-gray-500 text-xs">[${timestamp}]</span>
                    <span class="font-bold ${method === 'GET' ? 'text-blue-400' : method === 'POST' ? 'text-yellow-400' : 'text-purple-400'}">${method}</span>
                    <span class="text-gray-300 break-all">${url}</span>
                    <span class="${color} font-bold ml-auto">${status}</span>
                </div>
                <pre class="bg-gray-800/50 p-3 rounded text-xs text-gray-300 overflow-x-auto"><code class="language-json">${JSON.stringify(data, null, 2)}</code></pre>
            `;
            logArea.prepend(entry); // Newest on top
            hljs.highlightElement(entry.querySelector('code'));
        }

        // --- Helper: Request Wrapper ---
        async function request(endpoint, method = 'GET', body = null, isFile = false) {
            const baseUrl = document.getElementById('baseUrl').value.replace(/\/$/, '');
            const token = document.getElementById('authToken').value;
            
            const headers = {
                'Accept': 'application/json',
            };

            if (token) headers['Authorization'] = `Bearer ${token}`;
            if (body && !isFile) headers['Content-Type'] = 'application/json';

            const config = { method, headers };
            if (body) config.body = isFile ? body : JSON.stringify(body);

            try {
                const url = `${baseUrl}${endpoint}`;
                const res = await fetch(url, config);
                
                // Handle Blob (File Download)
                const contentType = res.headers.get("content-type");
                let responseData;
                
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    responseData = await res.json();
                } else {
                    responseData = { message: "Binary Data / File Response" };
                }

                log('RES', method, endpoint, res.status, responseData);
                return responseData;
            } catch (error) {
                log('ERR', method, endpoint, 'ERR', { error: error.message });
            }
        }

        // --- 1. Auth Functions ---
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPass').value;
            
            const res = await request('/auth/login', 'POST', { email, password });
            
            if (res && res.token) {
                document.getElementById('authToken').value = res.token;
            }
        }

        async function getUser() {
            await request('/user', 'GET');
        }

        function logout() {
            request('/auth/logout', 'POST');
            clearToken();
        }

        function clearToken() {
            document.getElementById('authToken').value = '';
        }

        // --- 2. Data Engine Functions ---
        async function fetchData() {
            const collection = document.getElementById('collectionName').value;
            if (!collection) return alert('Enter a table name first!');
            await request(`/data/${collection}`, 'GET');
        }

        async function createData() {
            const collection = document.getElementById('collectionName').value;
            if (!collection) return alert('Enter a table name first!');
            
            try {
                const payload = JSON.parse(document.getElementById('jsonPayload').value);
                await request(`/data/${collection}`, 'POST', payload);
            } catch (e) {
                alert('Invalid JSON in payload box');
            }
        }

        // --- 3. Storage Functions ---
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) return alert('Select a file!');

            const isPublic = document.getElementById('isPublic').checked;
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('folder', 'uploads');
            formData.append('is_public', isPublic ? '1' : '0');

            await request('/storage/upload', 'POST', formData, true);
        }

        function clearLog() {
            logArea.innerHTML = '<div class="text-gray-500 italic">Waiting for requests...</div>';
        }
    </script>
</body>
</html>